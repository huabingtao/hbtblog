(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{404:function(s,n,a){"use strict";a.r(n);var t=a(6),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"å‰è¨€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‰è¨€"}},[s._v("#")]),s._v(" å‰è¨€")]),s._v(" "),a("p",[s._v("ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ç¯‡å…¥é—¨çº§å‰åç«¯åˆ†ç¦»çš„å…¨æ ˆæ•™ç¨‹ã€‚å‰ç«¯ç”¨"),a("strong",[s._v("React")]),s._v("æ„å»ºï¼Œåç«¯"),a("strong",[s._v("Node + Koa2")]),s._v(" ä½¿ç”¨"),a("strong",[s._v("Sequelize")]),s._v("é“¾æ¥æ•°æ®åº“ï¼Œæ•°æ®åº“é‡‡ç”¨ "),a("strong",[s._v("mysql")]),s._v(" è™½ç„¶æ˜¯å…¥é—¨çº§ä½†è¿˜æ˜¯å¸Œæœ›ä½ äº†è§£è¿‡ React å’Œ Node æœ¬ç¯‡ä¸ä¼šå¯¹å¦‚ react ç»„ä»¶ã€Node.js æ¨¡å—ã€koa è·¯ç”±ã€koa ä¸­é—´ä»¶ç­‰åŸºæœ¬å†…å®¹ä½œè¯¦ç»†è®²è§£ï¼Œç”±äºæ—¶é—´å…³ç³» ui æ ·å¼ä¸ä½œä¸ºæœ¬æ¬¡å­¦ä¹ çš„é‡ç‚¹ä½¿ç”¨äº† antd-mobil æ¡†æ¶ã€‚")]),s._v(" "),a("h1",{attrs:{id:"é¡¹ç›®æˆªå›¾"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é¡¹ç›®æˆªå›¾"}},[s._v("#")]),s._v(" é¡¹ç›®æˆªå›¾")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/1.jpeg",alt:""}})]),s._v(" "),a("h1",{attrs:{id:"æºç è·å–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æºç è·å–"}},[s._v("#")]),s._v(" æºç è·å–")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://github.com/huabingtao/react-diary",target:"_blank",rel:"noopener noreferrer"}},[s._v("react å‰ç«¯æºç "),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"http://github.com/huabingtao/koa-diary",target:"_blank",rel:"noopener noreferrer"}},[s._v("node+koa2 åç«¯æºç "),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"node-åç«¯å¼€å‘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-åç«¯å¼€å‘"}},[s._v("#")]),s._v(" Node åç«¯å¼€å‘")]),s._v(" "),a("h2",{attrs:{id:"ç¯å¢ƒå®‰è£…"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå®‰è£…"}},[s._v("#")]),s._v(" ç¯å¢ƒå®‰è£…")]),s._v(" "),a("ul",[a("li",[s._v("mysql çš„ç‰ˆæœ¬å·: mysql-5.7.27")]),s._v(" "),a("li",[s._v("node çš„ç‰ˆæœ¬å· : 10.15.3")]),s._v(" "),a("li",[s._v("Navicat æ˜¯æ•°æ®åº“å¯è§†åŒ–å·¥å…·æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹æ•°æ®åº“ä¸­çš„è¡¨ï¼ŒåŒå­¦ä»¬é€‰æ‹©è¿›è¡Œå®‰è£…ã€‚")]),s._v(" "),a("li",[s._v("Postman ç”¨äºè°ƒè¯•æ¥å£çš„å·¥å…·ã€‚")])]),s._v(" "),a("h2",{attrs:{id:"node-åˆä½“éªŒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-åˆä½“éªŒ"}},[s._v("#")]),s._v(" Node åˆä½“éªŒ")]),s._v(" "),a("h3",{attrs:{id:"_1-åˆ›å»ºé¡¹ç›®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-åˆ›å»ºé¡¹ç›®"}},[s._v("#")]),s._v(" 1) åˆ›å»ºé¡¹ç›®")]),s._v(" "),a("p",[s._v("æ–°å»ºæ–‡ä»¶å¤¹ koa-diary åœ¨æ–‡ä»¶å¤¹ä¸‹æ–°å»º "),a("strong",[s._v("package.json")]),s._v(" å†™å…¥")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"koa-diary"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"main"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"index.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"license"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MIT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"devDependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"koa"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^2.7.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"koa-bodyparser"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^4.2.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"koa-router"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^7.4.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lodash"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^4.17.11"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"mysql2"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^1.6.5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"require-directory"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^2.1.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sequelize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^5.6.1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"validator"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^10.11.0"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nodemon --inspect-brk"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start:prod"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node app.js"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"koa2-cors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^2.0.6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"loadsh"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.4"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("æ‰§è¡Œ "),a("strong",[s._v("yarn")]),s._v(" æˆ–è€… "),a("strong",[s._v("npm install")]),s._v(" å®‰è£…ä¾èµ–\nè¿™äº›ä¾èµ–åˆ°ç”¨åˆ°çš„æ—¶å€™å†å»è§£é‡Šå…ˆå†²å°±å®Œäº‹äº†ï¼ï¼ï¼ğŸ¤£")]),s._v(" "),a("h3",{attrs:{id:"_2-ç¬¬ä¸€ä¸ª-node-ç¨‹åº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç¬¬ä¸€ä¸ª-node-ç¨‹åº"}},[s._v("#")]),s._v(" 2) ç¬¬ä¸€ä¸ª node ç¨‹åº")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬ä¸€èˆ¬ç¨‹åºä¸»å…¥å£ä¼šæ”¾åœ¨æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»º app.js æ·»åŠ ä»£ç ï¼š")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// app.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" Koa "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"koa"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Koa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"listen 3000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("æ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œ "),a("code",[s._v("node app.js")])]),s._v(" "),a("p",[s._v("å¦‚æœç»ˆç«¯æœ‰æ‰“å° "),a("code",[s._v("listen 3000")]),s._v(" node ç›‘å¬äº† 3000 ç«¯å£ï¼Œæ¥ä¸‹æ¥æ‰“å¼€æµè§ˆå™¨è¾“å…¥ "),a("em",[s._v("http://localhost:3000/")]),s._v(" å¦‚æœæµè§ˆå™¨è¿”å›å¦‚å›¾")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/2.jpeg",alt:""}}),s._v("\nè¯´æ˜æˆ‘ä»¬çš„æœåŠ¡å™¨å·²ç»æˆåŠŸå¯åŠ¨äº†ä½†ä¸ºä»€ä¹ˆè¿”å› "),a("strong",[s._v("Not Found")]),s._v(" å› ä¸ºæˆ‘ä»¬çš„æœåŠ¡ç¡®å®æ˜¯ä»€ä¹ˆéƒ½æ²¡è¿”å›å•Šï¼ï¼ï¼ï¼")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥æˆ‘ä»¬å†™ç‚¹ä¸œè¥¿è®© node è¿”å›ç‚¹ä¸œè¥¿ç»™å‰ç«¯! "),a("strong",[s._v("app.js")]),s._v(" ä¿®æ”¹å")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst app = new Koa()\napp.use(async (ctx, next) => {\n  ctx.response.body = '<h1>Hello, koa2!</h1>'\n})\n\napp.listen(3000)\nconsole.log('listen 3000')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("å†æ¬¡è®¿é—®"),a("em",[s._v("http://localhost:3000/")]),s._v(" ä¸å‡ºæ„å¤–ä½ ä¼šçœ‹åˆ°")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/3.jpeg",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_3-ä½¿ç”¨-koa-router"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä½¿ç”¨-koa-router"}},[s._v("#")]),s._v(" 3) ä½¿ç”¨ koa-router")]),s._v(" "),a("p",[s._v("æ‰“å¼€ "),a("strong",[s._v("app.js")]),s._v(" å¢åŠ å‡ è¡Œä»£ç ")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const Koa = require('koa')\nconst Router = require('koa-router')\nconst router = new Router()\nconst app = new Koa()\nrouter.get('/hello', (ctx, next) => {\n  ctx.body = 'hello koa'\n})\napp.use(router.routes())\napp.listen(3000)\nconsole.log('listen 3000')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000/hello ä¸å‡ºæ„å¤–å¦‚ä¸‹å›¾æ‰€ç¤º:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/4.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("æµè§ˆå™¨è¾“å‡ºäº† hello koa ç”¨ koa-router å†™æ¥å£è¦æ¯” node åŸç”Ÿçš„æ›´"),a("strong",[s._v("ç®€æ´")])]),s._v(" "),a("p",[a("strong",[s._v("è¿™éš¾é“å°±æ˜¯ä¼ è¯´ä¸­çš„æ¥å£å—ï¼Ÿï¼Ÿå¤§ä½¬å¤§ä½¬ï¼ï¼")])]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦è¿›è¡Œå®æˆ˜äº†ï¼Œå¦‚æœçœ‹åˆ°è¿™é‡Œä½ è¿˜æ˜¯æœ‰ç‚¹åƒåŠ›çš„è¯å»ºè®®ä½ å»æŠŠ"),a("strong",[s._v("Node.js")]),s._v("ä»¥åŠ"),a("strong",[s._v("koa2")]),s._v("åŸºç¡€è¡¥ä¸€ä¸‹å†æ¥é£Ÿç”¨å“¦ ğŸ˜")]),s._v(" "),a("h3",{attrs:{id:"_4-ä½¿ç”¨-nodemon-ç›‘æ§è¿›ç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-ä½¿ç”¨-nodemon-ç›‘æ§è¿›ç¨‹"}},[s._v("#")]),s._v(" 4) ä½¿ç”¨ nodemon ç›‘æ§è¿›ç¨‹")]),s._v(" "),a("p",[a("strong",[s._v("nodemon")]),s._v("æ˜¯ä¸€æ¬¾ç›‘æ§è¿›ç¨‹çš„å·¥å…·\nnodemon å¯ä»¥è®©æˆ‘ä»¬æ”¹å˜ä»£ç åä¸éœ€è¦æ‰‹åŠ¨é‡å¯æœåŠ¡ï¼Œå®ƒä¼šåœ¨æˆ‘ä»¬æ”¹å˜ä»£ç åè‡ªåŠ¨é‡å¯æœåŠ¡ã€‚")]),s._v(" "),a("p",[s._v("1 å…¨å±€å®‰è£… nodemon\n"),a("code",[s._v("yarn add nodemon -g")])]),s._v(" "),a("p",[s._v("2 æ‰“å¼€ vscode ç‚¹å‡»å·¦è¾¹çš„çˆ¬è™«é€‰æ‹©åˆ›å»º"),a("strong",[s._v("lunch.json")]),s._v("æ–‡ä»¶ï¼Œæ¥ç€é€‰æ‹© Node.js ç¯å¢ƒ")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/5.jpeg",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/6.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("3 æ‰“å¼€"),a("strong",[s._v("lunch.js")]),s._v("æ–‡ä»¶ æŠŠé…ç½®æ”¹ä¸º"),a("strong",[s._v("nodemon")]),s._v(" å»ç›‘å¬è¿›ç¨‹")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: http://go.microsoft.com/fwlink/?linkid=830387")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.2.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"configurations"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"request"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"launch"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nodemon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"runtimeExecutable"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nodemon"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"program"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${workspaceFolder}/app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"restart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"console"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"integratedTerminal"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"internalConsoleOptions"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"neverOpen"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"request"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"launch"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"å¯åŠ¨ç¨‹åº"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"program"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"${workspaceFolder}/app.js"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("4 é…ç½®å®ŒæˆåæŠŠé€‰é¡¹åˆ‡æ¢ä¸º"),a("strong",[s._v("nodemon")]),s._v(" ç‚¹å‡»è°ƒè¯•æŒ‰é’®å°±æ˜¯é‚£ä¸ªæ’­æ”¾æŒ‰é’®")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/7.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("å¦‚æœä½ çœ‹åˆ°æ§åˆ¶å°æœ‰å¦‚ä¸‹è¾“å‡ºï¼Œé‚£ä¹ˆ nodemon å·²ç»è¿è¡ŒæˆåŠŸäº†ã€‚")]),s._v(" "),a("p",[s._v("ç°åœ¨ä½ éšä¾¿æ”¹å‡ è¡Œä»£ç ä¿å­˜ä¸€ä¸‹å°±ä¼šå‘ç°"),a("strong",[s._v("nodemon")]),s._v("åœ¨è‡ªåŠ¨å¸®æˆ‘ä»¬é‡å¯ï¼Œå·æ‡’çš„æ„Ÿè§‰æ€ä¹ˆæ ·ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/8.jpeg",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_5-æ„å»ºé¡¹ç›®ç›®å½•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ„å»ºé¡¹ç›®ç›®å½•"}},[s._v("#")]),s._v(" 5) æ„å»ºé¡¹ç›®ç›®å½•")]),s._v(" "),a("p",[s._v("ä¸€ä¸ªå¥½çš„çš„é¡¹ç›®å¿…é¡»è¦æœ‰åˆç†çš„ç›®å½•ï¼Œæ–°å»ºå¦‚ä¸‹å›¾ä¸€äº›æ–‡ä»¶å¤¹ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/9.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥ä¼šå’Œå¤§å®¶è§£é‡Šè¿™äº›ç›®å½•çš„ç”¨å¤„ä¸è¦æ‰æ€¥ï¼ï¼ğŸ˜¸ğŸ˜¸")]),s._v(" "),a("h3",{attrs:{id:"_6-å…¨å±€åŠ¨æ€æ³¨å†Œè·¯ç”±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-å…¨å±€åŠ¨æ€æ³¨å†Œè·¯ç”±"}},[s._v("#")]),s._v(" 6) å…¨å±€åŠ¨æ€æ³¨å†Œè·¯ç”±")]),s._v(" "),a("p",[s._v("ç›®å‰æˆ‘ä»¬æ˜¯é‡‡å–"),a("code",[s._v("app.use(router.routes())")]),s._v("çš„æ–¹å¼æ‰‹åŠ¨å»æ³¨å†Œè·¯ç”±ã€‚è€Œä¸”è¿™å¾ˆä¸"),a("strong",[s._v("ä¼˜é›…")]),s._v("ä½†æ˜¯çœŸå®çš„å¼€å‘åœºæ™¯è·¯ç”±ä¸€èˆ¬ä¼šå¤šè¾¾å‡ åä¸ªç”šè‡³ä¸Šç™¾ä¸ªå†å»æ‰‹åŠ¨çš„æ–¹å¼æ³¨å†Œè·¯ç”±å°±æ˜¾å¾—æœ‰ç‚¹è ¢äº†ï¼Œæˆ‘ä»¬é¼“åŠ±ç¨‹åºå‘˜ â€œå·æ‡’â€ è¿™èƒ½è®©æˆ‘ä»¬çš„ä»£ç çœ‹ä¸Šå»æ›´"),a("strong",[s._v("ç®€æ´")])]),s._v(" "),a("p",[s._v("ç¬¬ä¸€æ­¥ åœ¨ app ç›®å½•ä¸‹æ–°å»º api æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ‰€æœ‰ api\nç¬¬äºŒæ­¥ åœ¨ api æ–‡ä»¶å¤¹ä¸‹æ–°å»º"),a("strong",[s._v("test.js")]),s._v("å†™å…¥å¦‚ä¸‹ä»£ç :")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/test.js\nconst Router = require('koa-router')\nconst router = new Router({\n  prefix: '/test'\n})\nrouter.get('/', async ctx => {\n  ctx.body = 'æµ‹è¯•'\n})\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ç¬¬ä¸‰æ­¥ åœ¨æ ¹ç›®å½•ä¸‹çš„ core æ–‡ä»¶å¤¹ä¸‹æ–°å»º "),a("strong",[s._v("init.js")]),s._v(" å†™å…¥å¦‚ä¸‹ä»£ç :")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// core/init.js\nconst Router = require('koa-router')\nconst Directory = require('require-directory')\n\nclass InitManager {\n  static initCore(app) {\n    InitManager.app = app\n    InitManager.initLoadRouters()\n  }\n\n  static initLoadRouters() {\n    function checkRouter(obj) {\n      if (obj instanceof Router) {\n        InitManager.app.use(obj.routes())\n      }\n    }\n    const path = process.cwd()\n    Directory(module, `${path}/app/api`, { visit: checkRouter })\n  }\n}\n\nmodule.exports = InitManager\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("ç¬¬å››æ­¥ æ”¹é€ "),a("strong",[s._v("app.js")]),s._v(" é‡å¯ç¨‹åº")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// app.js\nconst Koa = require('koa')\nconst InitManager = require('./core/init')\nconst app = new Koa()\nInitManager.initCore(app)\napp.listen(3000)\nconsole.log('listen 3000')\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("æ‰“å¼€ http://localhost:3000/test ä¸å‡ºæ„å¤–çš„è¯æµè§ˆå™¨æ˜¾ç¤ºå¦‚ä¸‹å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/10.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("ç°åœ¨æˆ‘ä»¬å·²ç»å¯ä»¥å®Œæˆ"),a("strong",[s._v("åŠ¨æ€æ³¨å†Œè·¯ç”±")]),s._v("äº†ï¼Œåªè¦æˆ‘ä»¬æŠŠè·¯ç”±å†™åœ¨"),a("strong",[s._v("api")]),s._v("æ–‡ä»¶å¤¹ä¸‹ç¨‹åºå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æ³¨å†Œã€‚")]),s._v(" "),a("h3",{attrs:{id:"_7-å…¨å±€å¼‚å¸¸æ•è·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-å…¨å±€å¼‚å¸¸æ•è·"}},[s._v("#")]),s._v(" 7) å…¨å±€å¼‚å¸¸æ•è·")]),s._v(" "),a("p",[s._v("å½“æˆ‘ä»¬ç¨‹åºå‡ºäº†æ•…éšœåº”è¯¥æ˜ç¡®åœ°æç¤ºç»™å‰ç«¯ç”¨æˆ·ä¹Ÿæ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•ä»£ç ã€‚æˆ‘ä»¬ä½¿ç”¨"),a("strong",[s._v("ä¸­é—´ä»¶")]),s._v("çš„æ–¹å¼å†™å…¨å±€å¼‚å¸¸æ•è·ï¼Œè¿™éœ€è¦äº†è§£"),a("strong",[s._v("koa2")]),s._v("è‘—åçš„"),a("strong",[s._v("æ´‹è‘±æ¨¡å‹")]),s._v("ï¼Œå› ä¸ºä¸æ˜¯æœ¬èŠ‚è¯¾é‡ç‚¹æ‰€ä»¥ä¸ä¼šè¯¦ç»†è®²è§£å®ƒã€‚å¦‚æœä¸æ‡‚ä»€ä¹ˆæ˜¯æ´‹è‘±æ¨¡å‹çš„è¯ä¸€å®šè¦å…ˆå»äº†è§£æ¸…æ¥šï¼ï¼")]),s._v(" "),a("p",[s._v("ç¬¬ä¸€æ­¥ åœ¨ config æ–‡ä»¶å¤¹ä¸‹æ–°å»º "),a("strong",[s._v("config.js")]),s._v(" å†™å…¥ä»£ç :")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// config/config.js\nmodule.exports = {\n  // prod\n  environment: 'dev'\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ç¬¬äºŒæ­¥ æ‰“å¼€ core æ–‡ä»¶å¤¹ä¸‹çš„"),a("strong",[s._v("init.js")]),s._v(" å®Œæ•´ä»£ç å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// core/init.js\nconst Router = require('koa-router')\nconst Directory = require('require-directory')\n\nclass InitManager {\n  static initCore(app) {\n    InitManager.app = app\n    InitManager.initLoadRouters()\n    InitManager.initLoadConfig()\n  }\n\n  static initLoadRouters() {\n    function checkRouter(obj) {\n      // console.log('obj', obj)\n\n      if (obj instanceof Router) {\n        InitManager.app.use(obj.routes())\n      }\n    }\n    const path = process.cwd()\n    Directory(module, `${path}/app/api`, { visit: checkRouter })\n  }\n\n  static initLoadConfig() {\n    const path = process.cwd() + '/config/config.js'\n    global.config = require(path)\n  }\n}\n\nmodule.exports = InitManager\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("ç¬¬äºŒæ­¥ åœ¨ core ä¸‹æ–°å»º"),a("strong",[s._v("http-exception.js")]),s._v(" å†™å…¥ä»£ç :")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// core/http-exception.js\nclass HttpException extends Error {\n  constructor(msg = 'æœåŠ¡å™¨å¼‚å¸¸', code = 400, errorCode = 10001) {\n    super()\n    this.msg = msg\n    this.code = code\n    this.errorCode = errorCode\n  }\n}\n\nmodule.exports = {\n  HttpException\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("ç¬¬ä¸‰æ­¥ åœ¨æ ¹ç›®å½•ä¸‹çš„"),a("strong",[s._v("middlewares")]),s._v("æ–‡ä»¶å¤¹ä¸‹æ–°å»º"),a("strong",[s._v("exception.js")]),s._v(" å†™å…¥ä»£ç :")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// middlewares/exception.js\nconst { HttpException } = require('../core/http-exception')\nconst catchError = async (ctx, next) => {\n  try {\n    await next()\n  } catch (error) {\n    const isHttpException = error instanceof HttpException\n    const isDev = global.config.environment === 'dev'\n    if (isDev) {\n      if (!isHttpException) {\n        throw error\n      }\n    }\n\n    if (isHttpException) {\n      ctx.body = {\n        message: error.msg,\n        errorCode: error.errorCode,\n        requestUrl: `${ctx.method} ${ctx.path}`\n      }\n      ctx.status = error.code\n    } else {\n      ctx.body = {\n        message: 'æœåŠ¡å™¨å‘ç”Ÿäº†ç‚¹é—®é¢˜è¯·ç¨åå†è¯•',\n        errorCode: '9999',\n        requestUrl: `${ctx.method} ${ctx.path}`\n      }\n      ctx.status = 500\n    }\n  }\n}\n\nmodule.exports = catchError\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("ç¬¬å››æ­¥ ä¿®æ”¹"),a("strong",[s._v("app.js")]),s._v(" å®Œæ•´ä»£ç å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// app.js\nconst Koa = require('koa')\nconst bodyParser = require('koa-bodyparser') // è·å–Bodyå‚æ•°\nconst InitManager = require('./core/init') //åŠ¨æ€æ³¨å†Œè·¯ç”± || å…¨å±€æŒ‚è½½config\nconst catchError = require('./middlewares/exception') // å…¨å±€å¼‚å¸¸\nconst cors = require('koa2-cors') // è§£å†³è·¨åŸŸ\n\nconst app = new Koa()\n\napp.use(cors())\napp.use(catchError)\napp.use(bodyParser())\nInitManager.initCore(app)\napp.listen(3000)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥æˆ‘ä»¬ä¿®æ”¹ä¸‹ api æ–‡ä»¶å¤¹ä¸‹çš„ test.js æµ‹è¯•ä»£ç æŠ›å‡ºä¸€ä¸ªæœåŠ¡ç«¯å¼‚å¸¸:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/test.js\nconst Router = require('koa-router')\n\nconst router = new Router({\n  prefix: '/test'\n})\n\nrouter.get('/', async ctx => {\n  throw new Error('æŠ›å‡ºå¼‚å¸¸')\n  ctx.body = 'æµ‹è¯•'\n})\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("åˆ·æ–°æµè§ˆå™¨æŸ¥çœ‹å¦‚æœæµè§ˆå™¨å‡ºç° Internal Server Error:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/11.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/12.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("æˆ‘ä»¬å·²ç»æˆåŠŸæ•è·åˆ°äº†é"),a("strong",[s._v("http å¼‚å¸¸")]),s._v("ï¼Œä¸€èˆ¬è¿™æ ·çš„å¼‚å¸¸æ˜¯ä¸æ›éœ²ç»™ç”¨æˆ·çœ‹åˆ°çš„ç ”å‘è‡ªå·±çŸ¥é“å°±å¯ä»¥äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨æµ‹è¯•ä»£ç æ¼”ç¤ºæŠ›å‡ºä¸€ä¸ª"),a("strong",[s._v("http å¼‚å¸¸")]),s._v("ã€‚")]),s._v(" "),a("p",[s._v("ä¿®æ”¹ "),a("strong",[s._v("test.js")]),s._v(" ä¿®æ”¹åå¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/test.js\nconst Router = require('koa-router')\nconst { HttpException } = require('../../core/http-exception')\n\nconst router = new Router({\n  prefix: '/test'\n})\n\nrouter.get('/', async ctx => {\n  // throw new Error('æŠ›å‡ºå¼‚å¸¸')\n  throw new HttpException()\n  ctx.body = 'æµ‹è¯•'\n})\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("åˆ·æ–° http://localhost:3000/test å¦‚å›¾:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/13.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("æ­¤æ—¶æˆ‘ä»¬å·²ç»æˆåŠŸæ•è·åˆ°äº†å¼‚å¸¸å¹¶æˆåŠŸè¿”å›ç»™äº†å‰ç«¯ã€‚")]),s._v(" "),a("h2",{attrs:{id:"ç”¨æˆ·æ³¨å†Œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨æˆ·æ³¨å†Œ"}},[s._v("#")]),s._v(" ç”¨æˆ·æ³¨å†Œ")]),s._v(" "),a("blockquote",[a("p",[s._v("å‰é¢åšäº†é‚£ä¹ˆå¤š,æ¯”å¦‚å¼‚å¸¸å¤„ç†ã€å…¨å±€åŠ¨æ€æ³¨å†Œè·¯ç”±ã€éƒ½æ˜¯ä¸ºäº†æ¥å£åšå‡†å¤‡çš„ã€‚")])]),s._v(" "),a("h4",{attrs:{id:"_1ï¼‰mysql-é…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1ï¼‰mysql-é…ç½®"}},[s._v("#")]),s._v(" 1ï¼‰mysql é…ç½®")]),s._v(" "),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("config")]),s._v("æ–‡ä»¶ä¸‹çš„ config.js æ–°å¢ mysql é…ç½®ä»£ç å¦‚ä¸‹ï¼š")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// config.js\nmodule.exports = {\n  // prod\n  environment: 'dev',\n  database: {\n    dbName: 'remind',\n    host: 'localhost',\n    port: 3306,\n    user: 'root',\n    password: '123456'\n  }\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("æˆ‘ä»¬é€šè¿‡"),a("strong",[s._v("sequelize.js")]),s._v("å»æ“ä½œæ•°æ®åº“,åœ¨"),a("strong",[s._v("core")]),s._v("ç›®å½•ä¸‹æ–°å¢æ–‡ä»¶"),a("strong",[s._v("db.js")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// db.js\nconst { Sequelize, Model } = require('sequelize')\nconst { unset, clone, isArray } = require('loadsh')\n\nconst {\n  dbName,\n  host,\n  port,\n  user,\n  password\n} = require('../config/config').database\nconst sequelize = new Sequelize(dbName, user, password, {\n  dialect: 'mysql', // è¿æ¥æ•°æ®åº“\n  host,\n  port,\n  timezone: '+08:00',\n  define: {\n    logging: true,\n    timestamps: true, // æ—¶é—´å­—æ®µ\n    paranoid: true, // åˆ é™¤å­—æ®µ\n    createdAt: 'created_at',\n    updatedAt: 'updated_at',\n    deletedAt: 'deleted_at',\n    underscored: true, // é©¼å³°è½¬åŒ–ä¸‹åˆ’çº¿\n    freezeTableName: true\n  }\n})\n\nsequelize.sync({\n  force: false\n})\n\nModel.prototype.toJSON = function() {\n  let data = clone(this.dataValues)\n  unset(data, 'updated_at')\n  unset(data, 'deleted_at')\n\n  if (isArray(this.exclude)) {\n    this.exclude.forEach(value => {\n      unset(data, value)\n    })\n  }\n\n  return data\n}\n\nmodule.exports = {\n  sequelize\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br")])]),a("p",[s._v("åœ¨"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹æ–°å»º"),a("strong",[s._v("user.js")]),s._v("åˆ é™¤ä¹‹å‰ç”¨äºæµ‹è¯•çš„ test.js,æ–°å¢ä»£ç :")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// user.js\nconst Router = require('koa-router')\n\nconst router = new Router({\n  prefix: '/user'\n})\nrouter.post('/register', async ctx => {\n\n})\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("blockquote",[a("p",[s._v("æ¥ç€æˆ‘ä»¬ç»™ç”¨æˆ·æ³¨å†Œå†™ "),a("strong",[s._v("æ ¡éªŒå™¨")]),s._v("ï¼Œæ ¡éªŒå™¨ä¹Ÿæ˜¯é€šè¿‡ä¸­é—´ä»¶çš„æ–¹å¼å»å®ç°çš„ã€‚å¦‚æœå‘ç”Ÿå¼‚å¸¸ä¼šç›´æ¥è¢«æˆ‘ä»¬çš„å…¨å±€å¼‚å¸¸æ‰€æ•è·åˆ°")])]),s._v(" "),a("p",[s._v("æ‰“æ¥ core ç›®å½•çš„"),a("strong",[s._v("http-exception.js")]),s._v("æ–°å¢"),a("strong",[s._v("ParameterException")]),s._v("å¼‚å¸¸ä¿®æ”¹å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// http-exception.js\nclass HttpException extends Error {\n  constructor(msg = 'æœåŠ¡å™¨å¼‚å¸¸', code = 400, errorCode = 10001) {\n    super()\n    this.msg = msg\n    this.code = code\n    this.errorCode = errorCode\n  }\n}\n\nclass ParameterException extends HttpException {\n  constructor(msg = 'å‚æ•°é”™è¯¯', errorCode) {\n    super()\n    this.msg = msg\n    this.errorCode = errorCode || 10001\n  }\n}\n\nmodule.exports = {\n  HttpException,\n  ParameterException\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("æ¥ä¸‹æ¥åœ¨"),a("strong",[s._v("app")]),s._v("ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹"),a("strong",[s._v("validators")]),s._v("å­˜æ”¾æˆ‘ä»¬çš„æ ¡éªŒå™¨ã€‚åœ¨ validators ä¸‹æ–°å»º"),a("strong",[s._v("validator.js")]),s._v(" å†™å…¥:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// validator.js\n\nconst validator = require('validator')\nconst { ParameterException } = require('../../core/http-exception')\n\nconst RegisterValidator = async function(ctx, next) {\n  const { email, password1, password2 } = ctx.request.body\n  let v = validator.isLength(email, { min: 6, max: 64 })\n  if (!v) {\n    throw new ParameterException('emailé•¿åº¦å¿…é¡»åœ¨6~64ä¸ªå­—ç¬¦')\n  }\n  v = validator.isEmail(email)\n  if (!v) {\n    throw new ParameterException('emailæ ¼å¼é”™è¯¯')\n  }\n  v = validator.isLength(password1, { min: 6, max: 32 })\n  if (!v) {\n    throw new ParameterException('å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦ï¼Œæœ€å¤š32ä¸ªå­—ç¬¦')\n  }\n  v = validator.isLength(password2, { min: 6, max: 32 })\n  if (!v) {\n    throw new ParameterException('å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦ï¼Œæœ€å¤š32ä¸ªå­—ç¬¦')\n  }\n  if (password1 !== password2) {\n    throw new ParameterException('ä¸¤ä¸ªå¯†ç å¿…é¡»ç›¸åŒ')\n  }\n  await next()\n}\n\nmodule.exports = {\n  RegisterValidator\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("æœ€åæˆ‘ä»¬ä¿®æ”¹ä¸‹ api ç›®å½•ä¸‹çš„"),a("strong",[s._v("user.js")]),s._v(",æŠŠæˆ‘ä»¬åˆšåˆšç¼–å†™çš„æ ¡éªŒå™¨ç”¨ä¸Šã€‚ä¿®æ”¹åçš„ user.js:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// user.js\nconst Router = require('koa-router')\nconst { RegisterValidator } = require('../validators/validator')\n\nconst router = new Router({\n  prefix: '/user'\n})\n\nrouter.post('/register', RegisterValidator, async ctx => {})\n\nmodule.exports = router\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("è¿è¡Œ nodemon åœ¨ postman æµ‹è¯•ä¸€ä¸‹å…ˆè¾“å…¥ä¸€äº›é”™è¯¯çš„å‚æ•°:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/14.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("å¯ä»¥çœ‹åˆ°æ ¡éªŒå™¨å¯ä»¥æˆåŠŸè¿è¡Œï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¼–å†™ä¸šåŠ¡ä»£ç å¾€æ•°æ®åº“æ’å…¥æ•°æ®äº†ã€‚")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬é€šè¿‡æ¨¡å‹çš„æ–¹å¼å»æ“ä½œæ•°æ®åº“ï¼Œåœ¨"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹æ–°å»º"),a("strong",[s._v("models")]),s._v("æ–‡ä»¶å¤¹ï¼Œæ¥ç€åœ¨ models ä¸‹æ–°å»º"),a("strong",[s._v("user.js")]),s._v("å†™å…¥ä»£ç :")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// user.js\nconst { Model, DataTypes } = require('sequelize')\nconst { sequelize } = require('../../core/db')\n\nclass User extends Model {}\n\nUser.init(\n  {\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    email: {\n      type: DataTypes.STRING,\n      unique: true\n    },\n    nickname: DataTypes.STRING,\n    password: DataTypes.STRING\n  },\n  {\n    sequelize,\n    tableName: 'user'\n  }\n)\n\nmodule.exports = {\n  User\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("å…ˆæŠŠå¼‚å¸¸ç±»è¡¥å……å®Œæ•´ "),a("strong",[s._v("http-exception.js")]),s._v(" å®Œæ•´ä»£ç å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// http-exception.js\nclass HttpException extends Error {\n  constructor(msg = 'æœåŠ¡å™¨å¼‚å¸¸', code = 400, errorCode = 10001) {\n    super()\n    this.msg = msg\n    this.code = code\n    this.errorCode = errorCode\n  }\n}\n\nclass ParameterException extends HttpException {\n  constructor(msg = 'å‚æ•°é”™è¯¯', errorCode) {\n    super()\n    this.msg = msg\n    this.errorCode = errorCode || 10001\n  }\n}\n\nclass Success extends HttpException {\n  constructor(msg = 'ok') {\n    super()\n    this.msg = msg\n    this.code = 201\n    this.errorCode = 0\n  }\n}\n\nclass NotFound extends HttpException {\n  constructor(msg = 'èµ„æºæœªæ‰¾åˆ°', errorCode) {\n    super()\n    this.msg = msg\n    this.code = 401\n    this.errorCode = errorCode || 10002\n  }\n}\n\nclass EmailRepetition extends HttpException {\n  constructor(msg = 'ç”¨æˆ·å·²å­˜åœ¨') {\n    super()\n    this.msg = msg\n    this.code = 402\n    this.errorCode = 10003\n  }\n}\n\nclass LikeError extends HttpException {\n  constructor(msg = 'ä½ å·²ç»ç‚¹è¿‡èµäº†', errorCode) {\n    super()\n    this.msg = msg\n    this.code = 402\n    this.errorCode = errorCode || 10004\n  }\n}\n\nmodule.exports = {\n  HttpException,\n  ParameterException,\n  Success,\n  NotFound,\n  EmailRepetition,\n  LikeError\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br")])]),a("p",[s._v("æ¨¡å‹åˆ›å»ºå¥½ä¹‹åæ‰“å¼€"),a("strong",[s._v("api ç›®å½•ä¸‹çš„ user.js")]),s._v(" ä¿®æ”¹åä»£ç å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// user.js\nconst Router = require('koa-router')\nconst { RegisterValidator } = require('../validators/validator')\nconst { EmailRepetition } = require('../../core/http-exception')\nconst { User } = require('../models/user')\n\nconst router = new Router({\n  prefix: '/user'\n})\n\nrouter.post('/register', RegisterValidator, async ctx => {\n  const { email, nickname, password1 } = ctx.request.body\n  const user = await User.findOne({\n    where: {\n      email\n    }\n  })\n  if (user) {\n    throw new EmailRepetition()\n  }\n  await User.create({ email, nickname, password: password1 })\n})\n\nmodule.exports = router\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("ç”¨ postman è°ƒç”¨ä¸€ä¸‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/15.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("è¿”å› Not Found åˆ·æ–°ä¸‹ user è¡¨:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/16.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("è¿™æ¡è®°å½•å·²ç»äº§ç”Ÿæˆ‘ä»¬è¿˜éœ€è¦ç»™å®¢æˆ·ç«¯ä¸€ä¸ªæ˜ç¡®çš„æˆåŠŸæç¤º")]),s._v(" "),a("p",[s._v("åœ¨"),a("strong",[s._v("app")]),s._v("ç›®å½•ä¸‹æ–°å»º"),a("strong",[s._v("lib")]),s._v("æ–‡ä»¶å¤¹æ–°å»ºå¸®åŠ©å‡½æ•°:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// lib/helper.js\nconst { Success } = require('../../core/http-exception')\nfunction success(msg) {\n  throw new Success(msg)\n}\n\nfunction formatDate(timeObj) {\n  const date = new Date(timeObj)\n  const y = date.getFullYear()\n  const m =\n    (date.getMonth() + 1).toString().length === 1\n      ? '0' + (date.getMonth() + 1)\n      : date.getMonth() + 1\n  const d =\n    date.getDate().toString().length === 1\n      ? '0' + date.getDate()\n      : date.getDate()\n  return y + 'å¹´' + m + 'æœˆ' + d + 'æ—¥'\n}\n\nmodule.exports = {\n  success,\n  formatDate\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("è¿”å›ä¸¤ä¸ªå‡½æ•°"),a("strong",[s._v("success")]),s._v("æ˜¯è¿™æ¬¡æˆ‘ä»¬éœ€è¦çš„ï¼ŒformatDate æˆ‘ä»¬åé¢åšæ—¥æœŸæ ¼å¼åŒ–çš„æ—¶å€™ä¼šç”¨åˆ°")]),s._v(" "),a("p",[s._v("æ”¹å†™"),a("strong",[s._v("api æ–‡ä»¶å¤¹ä¸‹çš„ user.js")]),s._v("åœ¨æ“ä½œæˆåŠŸåè¿”å›"),a("strong",[s._v("success")]),s._v("å‡½æ•°:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/user.js\nconst Router = require('koa-router')\nconst { RegisterValidator } = require('../validators/validator')\nconst { EmailRepetition } = require('../../core/http-exception')\nconst { success } = require('../lib/helper')\nconst { User } = require('../models/user')\n\nconst router = new Router({\n  prefix: '/user'\n})\n\nrouter.post('/register', RegisterValidator, async ctx => {\n  const { email, nickname, password1 } = ctx.request.body\n  const user = await User.findOne({\n    where: {\n      email\n    }\n  })\n  if (user) {\n    throw new EmailRepetition()\n  }\n  await User.create({ email, nickname, password: password1 })\n  success()\n})\n\nrouter.post('/login', async ctx => {\n  const { email, password } = ctx.request.body\n  const user = await User.validatorEmail(email, password)\n  ctx.body = {\n    user\n  }\n})\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("p",[s._v("æ¥ç€æˆ‘ä»¬æ”¹å˜ç‚¹å‚æ•°é€šè¿‡"),a("strong",[s._v("postman")]),s._v("è°ƒç”¨ä¸€ä¸‹ç»“æœåº”è¯¥èƒ½æ­£ç¡®è¿”å›:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/17.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("ok æˆåŠŸåœ°è¿”å›å‡ºäº† "),a("strong",[s._v("message errorCode å’Œ requestUrl")])]),s._v(" "),a("p",[s._v("åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬ç»ˆäºå†™å¥½äº†ä¸€ä¸ªæ¥å£ä¸å®¹æ˜“å•Š ğŸ˜‚")]),s._v(" "),a("h2",{attrs:{id:"ç”¨æˆ·ç™»å½•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç”¨æˆ·ç™»å½•"}},[s._v("#")]),s._v(" ç”¨æˆ·ç™»å½•")]),s._v(" "),a("blockquote",[a("p",[s._v("ç”¨æˆ·ç™»å½•é™¤äº†å¯¹ç”¨æˆ·é‚®ç®±å’Œå¯†ç çš„æ ¡éªŒï¼Œé¦–å…ˆæŸ¥è¯¢é‚®ç®±æ˜¯å¦å­˜åœ¨ï¼Œå…¶æ¬¡å†è¿›è¡Œå¯†ç çš„æ¯”å¯¹ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å¯¹å¯†ç è¿›è¡ŒåŠ å¯†æ›´ç¬¦åˆçœŸå®çš„å¼€å‘åœºæ™¯ã€‚")])]),s._v(" "),a("p",[s._v("æˆ‘ä»¬æŠŠå¯¹æ•°æ®åº“çš„æ“ä½œå†™åœ¨æ¨¡å‹ä¸Š,æ‰“å¼€"),a("strong",[s._v("models ç›®å½•ä¸‹çš„ user.js")]),s._v(" ä»£ç å¦‚ä¸‹:")]),s._v(" "),a("p",[s._v("æ–°å¢äº†ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œ"),a("em",[s._v("validatorUser")]),s._v("éªŒè¯ç”¨æˆ· id æ˜¯å¦å­˜åœ¨ "),a("em",[s._v("validatorEmail")]),s._v(" éªŒè¯ç”¨æˆ·é‚®ç®±æ˜¯å¦å­˜åœ¨")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// models/user.js\nconst { Model, DataTypes, Sequelize } = require('sequelize')\nconst { sequelize } = require('../../core/db')\nconst { NotFound } = require('../../core/http-exception')\n\nclass User extends Model {\n  static async validatorUser(id) {\n    const user = await User.findOne({\n      where: {\n        id\n      }\n    })\n    if (!user) {\n      throw new NotFound('è´¦å·ä¸å­˜åœ¨')\n    }\n    return user\n  }\n\n  static async validatorEmail(email, password) {\n    const user = await User.findOne({\n      where: {\n        email\n      }\n    })\n    if (!user) {\n      throw new NotFound('è´¦å·ä¸å­˜åœ¨')\n    }\n    if (user.password !== password) {\n      throw new NotFound('å¯†ç é”™è¯¯')\n    }\n    return user\n  }\n}\n\nUser.init(\n  {\n    id: {\n      type: DataTypes.INTEGER,\n      primaryKey: true,\n      autoIncrement: true\n    },\n    email: {\n      type: DataTypes.STRING,\n      unique: true\n    },\n    nickname: DataTypes.STRING,\n    password: DataTypes.STRING\n  },\n  {\n    sequelize,\n    tableName: 'user'\n  }\n)\n\nmodule.exports = {\n  User\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br")])]),a("p",[s._v("æ¥ç€æ‰“å¼€"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹çš„ user.js æ–°å¢"),a("strong",[s._v("è·¯ç”± login")]),s._v(":")]),s._v(" "),a("p",[s._v("è¿™ä¸ªè·¯ç”±å°±æ˜¯è°ƒç”¨äº†"),a("strong",[s._v("User")]),s._v("æ¨¡å‹ä¸Šçš„"),a("em",[s._v("validatorEmail")]),s._v("æ–¹æ³•æŠŠæŸ¥è¯¢åˆ°çš„ User è¿”å›ç»™å‰ç«¯ã€‚")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/user.js\nconst Router = require('koa-router')\nconst { RegisterValidator } = require('../validators/validator')\nconst { EmailRepetition } = require('../../core/http-exception')\nconst { success } = require('../lib/helper')\nconst { User } = require('../models/user')\n\nconst router = new Router({\n  prefix: '/user'\n})\n\nrouter.post('/register', RegisterValidator, async ctx => {\n  const { email, nickname, password1 } = ctx.request.body\n  const user = await User.findOne({\n    where: {\n      email\n    }\n  })\n  if (user) {\n    throw new EmailRepetition()\n  }\n  await User.create({ email, nickname, password: password1 })\n  success()\n})\n\nrouter.post('/login', async ctx => {\n  const { email, password } = ctx.request.body\n  const user = await User.validatorEmail(email, password)\n  ctx.body = {\n    user\n  }\n})\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("h2",{attrs:{id:"æ–°å¢æ—¥è®°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ–°å¢æ—¥è®°"}},[s._v("#")]),s._v(" æ–°å¢æ—¥è®°")]),s._v(" "),a("blockquote",[a("p",[s._v("æ–°å¢æ—¥è®°åªéœ€è¦å‰ç«¯ä¼ ç”¨æˆ· id å’Œ content å†…å®¹ï¼Œç”¨æˆ·æ˜µç§°æˆ‘ä»¬å¯ä»¥æ ¹æ®ç”¨æˆ· id å» user è¡¨é‡Œé¢å»è¯»ï¼Œé˜…è¯»æ•°é‡å’Œç‚¹èµæ•°éƒ½æ˜¯ 0 å¯ä»¥è®¾ç½®é»˜è®¤å€¼ã€‚")])]),s._v(" "),a("h3",{attrs:{id:"_1ï¼‰æ–°å»º-diary-æ¨¡å‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1ï¼‰æ–°å»º-diary-æ¨¡å‹"}},[s._v("#")]),s._v(" 1ï¼‰æ–°å»º diary æ¨¡å‹")]),s._v(" "),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("models")]),s._v("ä¸‹æ–°å»º"),a("strong",[s._v("diary.js")]),s._v("ï¼š")]),s._v(" "),a("p",[s._v("å®šä¹‰è¡¨åå’Œå­—æ®µéœ€è¦æ³¨æ„çš„æ˜¯è®¾ç½®"),a("strong",[s._v("favor_nums")]),s._v("å’Œ"),a("strong",[s._v("look_nums")]),s._v("çš„é»˜è®¤å€¼ä¸º 0ï¼Œ"),a("strong",[s._v("content")]),s._v("çš„é•¿åº¦å¤§å®¶å¯è§†æƒ…å†µã€‚")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// models/diary.js\n\nconst { Model, DataTypes } = require('sequelize')\nconst { sequelize } = require('../../core/db')\n\nclass Diary extends Model {}\n\nDiary.init(\n  {\n    uid: DataTypes.INTEGER,\n    nickname: DataTypes.STRING,\n    content: DataTypes.STRING(2000),\n    create_time: DataTypes.DATE,\n    favor_nums: {\n      type: DataTypes.INTEGER,\n      defaultValue: 0\n    },\n    look_nums: {\n      type: DataTypes.INTEGER,\n      defaultValue: 0\n    }\n  },\n  {\n    sequelize,\n    tableName: 'diary'\n  }\n)\n\nmodule.exports = {\n  Diary\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h3",{attrs:{id:"_2ï¼‰ç¼–å†™-diary-æ ¡éªŒå™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2ï¼‰ç¼–å†™-diary-æ ¡éªŒå™¨"}},[s._v("#")]),s._v(" 2ï¼‰ç¼–å†™ diary æ ¡éªŒå™¨")]),s._v(" "),a("blockquote",[a("p",[s._v("diary å¯¹åº”çš„æ¥å£å°±æ¯”è¾ƒå¤šäº†å› æ­¤æ ¡éªŒå™¨ä¹Ÿæ¯”è¾ƒå¤šï¼Œæ—¥è®°çš„å¢åˆ æ”¹æŸ¥æˆ‘ä»¬éƒ½è¦å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒã€‚")])]),s._v(" "),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("validators")]),s._v("ç›®å½•ä¸‹çš„"),a("strong",[s._v("validator.js")]),s._v(" å®Œæ•´ä»£ç å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// validators/validator.js\nconst validator = require('validator')\nconst { ParameterException } = require('../../core/http-exception')\n\nconst RegisterValidator = async function(ctx, next) {\n  const { email, password1, password2 } = ctx.request.body\n  let v = validator.isLength(email, { min: 6, max: 64 })\n  if (!v) {\n    throw new ParameterException('emailé•¿åº¦å¿…é¡»åœ¨6~64ä¸ªå­—ç¬¦')\n  }\n  v = validator.isEmail(email)\n  if (!v) {\n    throw new ParameterException('emailæ ¼å¼é”™è¯¯')\n  }\n  v = validator.isLength(password1, { min: 6, max: 32 })\n  if (!v) {\n    throw new ParameterException('å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦ï¼Œæœ€å¤š32ä¸ªå­—ç¬¦')\n  }\n  v = validator.isLength(password2, { min: 6, max: 32 })\n  if (!v) {\n    throw new ParameterException('å¯†ç è‡³å°‘6ä¸ªå­—ç¬¦ï¼Œæœ€å¤š32ä¸ªå­—ç¬¦')\n  }\n  if (password1 !== password2) {\n    throw new ParameterException('ä¸¤ä¸ªå¯†ç å¿…é¡»ç›¸åŒ')\n  }\n  await next()\n}\n\nconst DiaryValidator = async (ctx, next) => {\n  const { content } = ctx.request.body\n  if (content.length > 1000) {\n    throw new ParameterException('å†…å®¹è¶…è¿‡1000å­—')\n  }\n  await next()\n}\n\nconst GetDiaryValidator = async (ctx, next) => {\n  const { start, count } = ctx.request.query\n  if (!start || !count) {\n    await next()\n    return\n  }\n  let v = validator.isInt(start)\n  if (!v) {\n    throw new ParameterException('startä¸ç¬¦åˆè§„èŒƒ')\n  }\n  v = validator.isInt(count)\n  if (!v) {\n    throw new ParameterException('countä¸ç¬¦åˆè§„èŒƒ')\n  }\n  await next()\n}\n\nconst PutDiaryValidator = async (ctx, next) => {\n  const { content } = ctx.request.body\n  let v = validator.isEmpty(content)\n  if (v) {\n    throw new ParameterException('contentä¸èƒ½ä¸ºç©º')\n  }\n  await next()\n}\n\nconst PostFavorValidator = async (ctx, next) => {\n  const { uid, diary_id } = ctx.request.body\n  let v = validator.isInt(uid.toString())\n  if (!v) {\n    throw new ParameterException('uid ä¸ç¬¦åˆè§„èŒƒ')\n  }\n  v = validator.isInt(diary_id.toString())\n  if (!v) {\n    throw new ParameterException('diary_id ä¸ç¬¦åˆè§„èŒƒ')\n  }\n  await next()\n}\n\nmodule.exports = {\n  RegisterValidator,\n  DiaryValidator,\n  GetDiaryValidator,\n  PutDiaryValidator,\n  PostFavorValidator\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br")])]),a("h3",{attrs:{id:"_3ï¼‰ç¼–å†™-diary-æ¥å£"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3ï¼‰ç¼–å†™-diary-æ¥å£"}},[s._v("#")]),s._v(" 3ï¼‰ç¼–å†™ diary æ¥å£")]),s._v(" "),a("p",[s._v("æ¥ç€åœ¨"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹æ–°å»º"),a("strong",[s._v("diary.js")]),s._v(",æ–°å¢æ—¥è®°çš„æ¥å£æ¯”è¾ƒç®€å•å°±æ˜¯æŠŠç”¨æˆ·è¾“å…¥çš„å†…å®¹æ’åˆ° diary è¡¨é‡Œå»ã€‚")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/diary.js\n\nconst Router = require('koa-router')\nconst { DiaryValidator } = require('../validators/validator')\nconst { success } = require('../lib/helper')\nconst { User } = require('../models/user')\nconst { Diary } = require('../models/diary')\n\nconst router = new Router({\n  prefix: '/diary'\n})\n\nrouter.post('/', DiaryValidator, async ctx => {\n  const { id, content } = ctx.request.body\n  const user = await User.validatorUser(id)\n  const date = new Date()\n  await Diary.create({\n    uid: id,\n    content,\n    nickname: user.nickname,\n    create_time: date,\n    favor_num: 0\n  })\n  success()\n})\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[a("strong",[s._v("postman")]),s._v("è°ƒç”¨ä¸€ä¸‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/18.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("åˆ·æ–° Navicat åæ–°å¢ä¸€æ¡è®°å½•")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/19.jpeg",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"æŸ¥çœ‹æ—¥è®°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹æ—¥è®°"}},[s._v("#")]),s._v(" æŸ¥çœ‹æ—¥è®°")]),s._v(" "),a("p",[s._v("æŸ¥çœ‹æ—¥è®°çš„åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ ¹æ®æ—¥è®°çš„ id å» diary è¡¨é‡Œå–å¯¹åº”çš„è®°å½•å°± okã€‚")]),s._v(" "),a("blockquote",[a("p",[s._v("éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªé˜…è¯»æ¬¡æ•°çš„åŠŸèƒ½ã€‚æ‰€ä»¥æ¯æŸ¥çœ‹ä¸€æ¬¡æˆ‘ä»¬å°±åœ¨å¯¹åº”è®°å½•ä¸‹ look_nums é€’å¢ 1 æ¬¡ã€‚")])]),s._v(" "),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹çš„ diaryl.js æ–°å¢ä»£ç å¦‚ä¸‹:")]),s._v(" "),a("p",[a("strong",[s._v("formatDate")]),s._v("å‡½æ•°å¯¹è¾“å‡ºçš„æ—¶é—´æˆ³è½¬åŒ–ä¸º"),a("strong",[s._v("xxxx å¹´ xx æœˆ xx æ—¥")]),s._v("æ ¼å¼ã€‚")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/diary.js\nconst Router = require('koa-router')\nconst { DiaryValidator } = require('../validators/validator')\nconst { success } = require('../lib/helper')\nconst { User } = require('../models/user')\nconst { Diary } = require('../models/diary')\nconst { formatDate } = require('../lib/helper')\n\nconst router = new Router({\n  prefix: '/diary'\n})\n\nrouter.post('/', DiaryValidator, async ctx => {\n  const { id, content } = ctx.request.body\n  const user = await User.validatorUser(id)\n  const date = new Date()\n  await Diary.create({\n    uid: id,\n    content,\n    nickname: user.nickname,\n    create_time: date,\n    favor_num: 0\n  })\n  success()\n})\n\nrouter.get('/:id', async ctx => {\n  const { id } = ctx.params\n  const diary = await Diary.findOne({\n    where: {\n      id: parseInt(id)\n    }\n  })\n  if (!diary) {\n    throw new NotFound('æ–‡ç« æœªæ‰¾åˆ°')\n  }\n  await diary.increment('look_nums', {\n    by: 1\n  })\n  diary.setDataValue('create_time', formatDate(diary.create_time))\n  ctx.body = diary\n})\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br")])]),a("p",[s._v("ä½¿ç”¨"),a("strong",[s._v("postman")]),s._v("è°ƒç”¨ä¸€ä¸‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/20.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("ok æˆåŠŸæŸ¥å‡ºæ—¥è®°å¹¶ä¸”"),a("strong",[s._v("look_nums")]),s._v("ä¹Ÿå¢åŠ äº† 1ã€‚")]),s._v(" "),a("h2",{attrs:{id:"ç‚¹èµæ—¥è®°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç‚¹èµæ—¥è®°"}},[s._v("#")]),s._v(" ç‚¹èµæ—¥è®°")]),s._v(" "),a("p",[s._v("æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¡¨æ¥è®°å½•è°å¯¹è¿™æ¡æ—¥è®°è¿›è¡Œçš„ç‚¹èµï¼Œå¹¶ä¸”åœ¨æ—¥è®°çš„åˆ—è¡¨é¡µé¢éœ€è¦æŠŠè¿™ç¯‡æ—¥è®°çš„ç‚¹èµæ•°é‡ç»Ÿè®¡å‡ºæ¥ã€‚")]),s._v(" "),a("h3",{attrs:{id:"_1ï¼‰ç¼–å†™-favor-æ¨¡å‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1ï¼‰ç¼–å†™-favor-æ¨¡å‹"}},[s._v("#")]),s._v(" 1ï¼‰ç¼–å†™ favor æ¨¡å‹")]),s._v(" "),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("models")]),s._v("ç›®å½•æ–°å»º"),a("strong",[s._v("favor.js")]),s._v("ï¼Œå¹¶åˆ›å»ºé™æ€æ–¹æ³•"),a("strong",[s._v("increment")]),s._v("ã€‚\né¦–å…ˆæŸ¥è¯¢æ˜¯å¦è¿™ç¯‡æ—¥è®°å·²ç»è¢«ç‚¹èµäº†ï¼Œå¦‚æœæ˜¯"),a("strong",[s._v("åˆ™æŠ›å‡ºå¼‚å¸¸")]),s._v("ã€‚å¦‚æœæ²¡æœ‰è¢«ç‚¹èµåˆ™å¾€"),a("strong",[s._v("favor")]),s._v("è¡¨é‡Œå¢åŠ ä¸€æ¡è®°å½•ä¸”ä¸º"),a("strong",[s._v("diary")]),s._v("è¡¨é‡Œçš„"),a("strong",[s._v("favor_nums")]),s._v("å­—æ®µåŠ  1ï¼Œä¸ºäº†ä¿æŒæ•°æ®åº“æ•°æ®ä¸€è‡´æ€§ç”¨äº†"),a("strong",[s._v("æ•°æ®åº“äº‹åŠ¡")]),s._v("çš„æ–¹å¼ã€‚")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const { Model, DataTypes } = require('sequelize')\nconst { sequelize } = require('../../core/db')\nconst { NotFound, LikeError } = require('../../core/http-exception')\nconst { User } = require('./user')\n\nclass Favor extends Model {\n  static async increment(uid, diary_id) {\n    await User.validatorUser(uid)\n    const f = await Favor.findOne({\n      where: {\n        uid,\n        diary_id\n      }\n    })\n    if (f) {\n      throw new LikeError()\n    }\n    return sequelize.transaction(async t => {\n      await Favor.create(\n        {\n          uid,\n          diary_id\n        },\n        { transaction: t }\n      )\n      const { Diary } = require('./diary')\n      const diary = await Diary.findOne({\n        where: {\n          id: diary_id\n        }\n      })\n      if (!diary) {\n        throw new NotFound('æ—¥è®°ä¸å­˜åœ¨')\n      }\n      await diary.increment('favor_nums', { by: 1, transaction: t })\n    })\n  }\n}\n\nFavor.init(\n  {\n    uid: DataTypes.INTEGER,\n    diary_id: DataTypes.INTEGER\n  },\n  {\n    sequelize,\n    tableName: 'favor'\n  }\n)\n\nmodule.exports = {\n  Favor\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("h3",{attrs:{id:"_2-ç¼–å†™ç‚¹èµæ¥å£"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-ç¼–å†™ç‚¹èµæ¥å£"}},[s._v("#")]),s._v(" 2) ç¼–å†™ç‚¹èµæ¥å£")]),s._v(" "),a("p",[s._v("è€æ ·å­åœ¨"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹æ–°å»º"),a("strong",[s._v("favor.js")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/favor.js\nconst Router = require('koa-router')\nconst { PostFavorValidator } = require('../validators/validator')\nconst { success } = require('../lib/helper')\nconst { Favor } = require('../models/favor')\n\nconst router = new Router({\n  prefix: '/favor'\n})\n\nrouter.post('/', PostFavorValidator, async ctx => {\n  const { uid, diary_id } = ctx.request.body\n  await Favor.increment(uid, diary_id)\n  success()\n})\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("ç”¨"),a("strong",[s._v("postman")]),s._v("è°ƒè¯•ä¸€ä¸‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/21.jpeg",alt:""}})]),s._v(" "),a("p",[a("strong",[s._v("Navicate")]),s._v(" åˆ·æ–°"),a("strong",[s._v("favor")]),s._v("è¡¨æŸ¥çœ‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/22.jpeg",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"æ—¥è®°åˆ—è¡¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ—¥è®°åˆ—è¡¨"}},[s._v("#")]),s._v(" æ—¥è®°åˆ—è¡¨")]),s._v(" "),a("p",[s._v("åˆ†ä¸ºä¸¤ä¸ªåˆ—è¡¨ï¼Œä¸€ä¸ªæ˜¯æ‰€æœ‰çš„æ—¥è®°åˆ—è¡¨ï¼Œä¸€ä¸ªæ˜¯æˆ‘çš„æ—¥è®°åˆ—è¡¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å‰ç«¯çš„æ˜¾ç¤ºé¡µé¢éœ€è¦æ˜¾ç¤ºæ—¥è®°çš„ç‚¹èµçŠ¶æ€ï¼Œç‚¹èµçŠ¶æ€ä»"),a("strong",[s._v("favor")]),s._v("è¡¨é‡Œå¾—åˆ°ã€‚")]),s._v(" "),a("h3",{attrs:{id:"æˆ‘çš„æ—¥è®°åˆ—è¡¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æˆ‘çš„æ—¥è®°åˆ—è¡¨"}},[s._v("#")]),s._v(" æˆ‘çš„æ—¥è®°åˆ—è¡¨")]),s._v(" "),a("p",[s._v("æˆ‘çš„æ—¥è®°åˆ—è¡¨é€»è¾‘éœ€è¦ç”¨æˆ·"),a("strong",[s._v("id")]),s._v("æŸ¥è¯¢ï¼Œå¹¶ä¸”ä» favor è¡¨é‡ŒæŸ¥å‡ºå½“å‰ç”¨æˆ· id çš„ç‚¹èµçš„æ—¥è®°ç„¶åå–åˆ° diary_idï¼Œå†ä¸ä»æˆ‘çš„æ—¥è®°åˆ—è¡¨è¿›è¡Œå¯¹æ¯”å¦‚æœæœ‰çºªå½•åˆ™è¯´æ˜è¿™æ¡æ—¥è®°è¢«ç‚¹èµäº†ã€‚")]),s._v(" "),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("models")]),s._v("ç›®å½•ä¸‹çš„"),a("strong",[s._v("diary.js")]),s._v("æ–°å¢é™æ€æ–¹æ³•"),a("strong",[s._v("getDiary")]),s._v(" æ”¹å˜åçš„ä»£ç å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const { Model, DataTypes, Op } = require('sequelize')\nconst { sequelize } = require('../../core/db')\nconst { NotFound } = require('../../core/http-exception')\nconst { formatDate } = require('../lib/helper')\nconst { User } = require('./user')\nconst { Favor } = require('./favor')\n\nclass Diary extends Model {\n  static async getDiary(id, start = 0, count = 10) {\n    await User.validatorUser(id)\n    const favors = await Favor.findAll({\n      where: {\n        uid: id\n      }\n    })\n    const diaryIds = favors.map(f => {\n      return f.diary_id\n    })\n    const diary = await Diary.findAll({\n      order: [['id', 'DESC']],\n      where: {\n        uid: id\n      },\n      offset: parseInt(start),\n      limit: parseInt(count)\n    })\n    diary.forEach(item => {\n      item.dataValues.create_time = formatDate(item.dataValues.create_time)\n      if (diaryIds.includes(item.id)) {\n        item.dataValues.isFavor = 1\n      } else {\n        item.dataValues.isFavor = 0\n      }\n    })\n    return diary\n  }\n}\n\nDiary.init(\n  {\n    uid: DataTypes.INTEGER,\n    nickname: DataTypes.STRING,\n    content: DataTypes.STRING(2000),\n    create_time: DataTypes.DATE,\n    favor_nums: {\n      type: DataTypes.INTEGER,\n      defaultValue: 0\n    },\n    look_nums: {\n      type: DataTypes.INTEGER,\n      defaultValue: 0\n    }\n  },\n  {\n    sequelize,\n    tableName: 'diary'\n  }\n)\n\nmodule.exports = {\n  Diary\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br")])]),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹çš„"),a("strong",[s._v("diary.js")]),s._v(" ä¿®æ”¹å¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/diary.js\nconst Router = require('koa-router')\nconst {\n  DiaryValidator,\n  GetDiaryValidator\n} = require('../validators/validator')\nconst { NotFound } = require('../../core/http-exception')\nconst { success } = require('../lib/helper')\nconst { User } = require('../models/user')\nconst { Diary } = require('../models/diary')\nconst { formatDate } = require('../lib/helper')\n\nconst router = new Router({\n  prefix: '/diary'\n})\n\nrouter.post('/', DiaryValidator, async ctx => {\n  const { id, content } = ctx.request.body\n  const user = await User.validatorUser(id)\n  const date = new Date()\n  await Diary.create({\n    uid: id,\n    content,\n    nickname: user.nickname,\n    create_time: date,\n    favor_num: 0\n  })\n  success()\n})\n\nrouter.get('/myDiary', GetDiaryValidator, async ctx => {\n  const { id, start, count } = ctx.request.query\n  const diarys = await Diary.getDiary(id, start, count)\n  ctx.body = diarys\n})\n\nrouter.get('/:id', async ctx => {\n  xq\n  const { id } = ctx.params\n  const diary = await Diary.findOne({\n    where: {\n      id: parseInt(id)\n    }\n  })\n  if (!diary) {\n    throw new NotFound('æ–‡ç« æœªæ‰¾åˆ°')\n  }\n  await diary.increment('look_nums', {\n    by: 1\n  })\n  diary.setDataValue('create_time', formatDate(diary.create_time))\n  ctx.body = diary\n})\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br")])]),a("p",[s._v("ç”¨"),a("strong",[s._v("postman")]),s._v("æµ‹è¯•ä¸€ä¸‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/23.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("å…¶ä¸­ "),a("strong",[s._v("isFavor")]),s._v(" å°±æ˜¯ç‚¹èµçŠ¶æ€ï¼š0 ä¸ºæ²¡ç‚¹èµ 1 ä¸ºç‚¹èµ")]),s._v(" "),a("h3",{attrs:{id:"å¹¿åœºæ—¥è®°åˆ—è¡¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¹¿åœºæ—¥è®°åˆ—è¡¨"}},[s._v("#")]),s._v(" å¹¿åœºæ—¥è®°åˆ—è¡¨")]),s._v(" "),a("p",[s._v("å…¶å®è¿™ä¿©æ—¥è®°åˆ—è¡¨åŠŸèƒ½æ¯”è¾ƒç±»ä¼¼ï¼Œæˆ‘ä»¬æŠŠé€»è¾‘æ¯”è¾ƒå¤æ‚çš„å†™åœ¨æ¨¡å‹ä¸Šã€‚")]),s._v(" "),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("models")]),s._v("ç›®å½•ä¸‹"),a("strong",[s._v("diary.js")]),s._v(",æ–°å¢"),a("strong",[s._v("getAllDiary")]),s._v("é™æ€æ–¹æ³• æ›´æ”¹åå¦‚ä¸‹:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// models/diary.js\n\nconst { Model, DataTypes, Op } = require('sequelize')\nconst { sequelize } = require('../../core/db')\nconst { NotFound } = require('../../core/http-exception')\nconst { formatDate } = require('../lib/helper')\nconst { User } = require('./user')\nconst { Favor } = require('./favor')\n\nclass Diary extends Model {\n  static async getDiary(id, start = 0, count = 10) {\n    await User.validatorUser(id)\n    const favors = await Favor.findAll({\n      where: {\n        uid: id\n      }\n    })\n    const diaryIds = favors.map(f => {\n      return f.diary_id\n    })\n    const diary = await Diary.findAll({\n      order: [['id', 'DESC']],\n      where: {\n        uid: id\n      },\n      offset: parseInt(start),\n      limit: parseInt(count)\n    })\n    diary.forEach(item => {\n      item.dataValues.create_time = formatDate(item.dataValues.create_time)\n      if (diaryIds.includes(item.id)) {\n        item.dataValues.isFavor = 1\n      } else {\n        item.dataValues.isFavor = 0\n      }\n    })\n    return diary\n  }\n\n\n  static async getAllDiary(start, count, uid) {\n    const diary = await Diary.findAll({\n      order: [['id', 'DESC']],\n      offset: parseInt(start),\n      limit: parseInt(count)\n    })\n\n    const favors = await Favor.findAll({\n      where: {\n        uid\n      }\n    })\n\n    const diaryIds = favors.map(f => {\n      return f.diary_id\n    })\n\n    diary.forEach(item => {\n      item.dataValues.create_time = formatDate(item.dataValues.create_time)\n      if (diaryIds.includes(item.id)) {\n        item.dataValues.isFavor = 1\n      } else {\n        item.dataValues.isFavor = 0\n      }\n    })\n    return diary\n  }\n}\n\nDiary.init(\n  {\n    uid: DataTypes.INTEGER,\n    nickname: DataTypes.STRING,\n    content: DataTypes.STRING(2000),\n    create_time: DataTypes.DATE,\n    favor_nums: {\n      type: DataTypes.INTEGER,\n      defaultValue: 0\n    },\n    look_nums: {\n      type: DataTypes.INTEGER,\n      defaultValue: 0\n    }\n  },\n  {\n    sequelize,\n    tableName: 'diary'\n  }\n)\n\nmodule.exports = {\n  Diary\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br")])]),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹"),a("strong",[s._v("diary.js")]),s._v("æ–°å¢æŸ¥è¯¢å¹¿åœºæ—¥è®°çš„è·¯ç”±:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("router.get('/', GetDiaryValidator, async ctx => {\n  const { start = 0, count = 10, uid } = ctx.request.query\n  const diarys = await Diary.getAllDiary(start, count, uid)\n  ctx.body = diarys\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("postman")]),s._v("è·‘ä¸€ä¸‹:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/24.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œæ—¥è®°åˆ—è¡¨å¼€å‘å®Œæˆäº†è¿˜å‰©ä¸‹åˆ é™¤æ—¥è®°æ›´æ–°æ—¥è®°ä¸¤ä¸ªåŠŸèƒ½å¤§å®¶åŠ æ²¹ï¼")]),s._v(" "),a("h2",{attrs:{id:"æ›´æ–°æ—¥è®°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ›´æ–°æ—¥è®°"}},[s._v("#")]),s._v(" æ›´æ–°æ—¥è®°")]),s._v(" "),a("p",[s._v("æ›´æ–°æ—¥è®°çš„é€»è¾‘æ¯”è¾ƒç®€å•ç›´æ¥çœ‹ä»£ç :")]),s._v(" "),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("models")]),s._v("ç›®å½•ä¸‹"),a("strong",[s._v("diary.js")]),s._v("æ–°å¢ updateDiary æ–¹æ³•:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("static async updateDiary(uid, id, content) {\nawait User.validatorUser(uid)\nconst diary = await Diary.update(\n  {\n    content\n  },\n  {\n    where: {\n      id\n    }\n  }\n)\nreturn diary\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("æ¥ç€æ–°å¢æ¥å£åœ¨"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹çš„"),a("strong",[s._v("diary.js")]),s._v("æ–°å¢:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// api/diary.js\nrouter.put('/', PutDiaryValidator, async ctx => {\n  const { uid, id, content } = ctx.request.body\n  await Diary.updateDiary(uid, id, content)\n  success()\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("ç”¨ postman è¿è¡Œ:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/25.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("æ›´æ–°æˆåŠŸ")]),s._v(" "),a("h2",{attrs:{id:"åˆ é™¤æ—¥è®°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆ é™¤æ—¥è®°"}},[s._v("#")]),s._v(" åˆ é™¤æ—¥è®°")]),s._v(" "),a("p",[s._v("åˆ é™¤æ—¥è®°çš„é€»è¾‘å°±æ¯”è¾ƒç®€å•äº†ï¼Œåªè¦æ‰¾åˆ°å¯¹åº”æ—¥è®° id åˆ é™¤å°±è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ•°æ®åº“æœ‰"),a("strong",[s._v("è½¯åˆ é™¤å’Œç¡¬åˆ é™¤ä¸¤ç§")]),s._v(" ã€‚è½¯åˆ é™¤æ˜¯ä¸åˆ é™¤è®°å½•å¦å¤–ç»™æ­¤æ¡è®°å½•å¢åŠ ä¸€ä¸ªåˆ é™¤æ—¥æœŸï¼Œç¡¬åˆ é™¤å°±æ˜¯å»çœŸæ­£çš„åˆ é™¤è¿™æ¡è®°å½•ï¼Œæˆ‘ä»¬é€‰æ‹©ç¡¬åˆ é™¤ã€‚")]),s._v(" "),a("p",[s._v("åˆ›å»ºæ¨¡å‹æ‰“å¼€"),a("strong",[s._v("models")]),s._v("ç›®å½•ä¸‹çš„"),a("strong",[s._v("diary.js")]),s._v("å¢åŠ åˆ é™¤æ–¹æ³•:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// models/diary.js\n\nstatic async deleteDiary(uid, id) {\n    await User.validatorUser(uid)\n    const diary = await Diary.destroy({\n      force: true, // ç¡¬åˆ é™¤\n      where: {\n        id\n      }\n    })\n    return diary\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("æ‰“å¼€"),a("strong",[s._v("api")]),s._v("ç›®å½•ä¸‹ diary.js æ–°å¢:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("router.delete('/', async ctx => {\n  const { uid, id } = ctx.request.body\n  await Diary.deleteDiary(uid, id)\n  success()\n})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("è¿è¡Œ postman è°ƒç”¨æ¥å£:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/26.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("åˆ·æ–° Navicate:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://file.huabingtao.com/juejin/nodeKoa/27.jpeg",alt:""}})]),s._v(" "),a("p",[s._v("åˆ é™¤æ—¥è®°æˆåŠŸï¼")]),s._v(" "),a("h1",{attrs:{id:"æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[s._v("#")]),s._v(" æ€»ç»“")]),s._v(" "),a("p",[s._v("åˆ°è¿™é‡Œåç«¯éƒ¨åˆ†å·²ç»ç»“æŸäº†ï¼Œæˆ‘ç›¸ä¿¡å¦‚æœä½ è®¤çœŸçœ‹å®Œè‚¯å®šä¼šæœ‰æ”¶è·çš„ã€‚æˆ‘ä»¬ç®€å•æ€»ç»“ä¸‹å­¦åˆ°äº†å“ªäº›ä¸œè¥¿ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("å…¨å±€åŠ¨æ€æ³¨å†Œè·¯ç”±")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ä¸­é—´ä»¶å»å¤„ç†å¼‚å¸¸")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ Sequelize æ“ä½œæ•°æ®åº“")]),s._v(" "),a("li",[s._v("ä½¿ç”¨ async è¯­æ³•ï¼ŒåŒæ­¥çš„æ–¹å¼å¤„ç†å¼‚æ­¥")]),s._v(" "),a("li",[s._v("ç»“æ„åŒ–ç»„ä»¶åŒ–å¼€å‘é¡¹ç›®")])]),s._v(" "),a("p",[s._v("æœ€åï¼Œæ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œæœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆè¯·ç»™æˆ‘ç•™è¨€ã€‚")])])}),[],!1,null,null,null);n.default=e.exports}}]);